{% extends "base.html" %}

{% block title %}Repository management{% endblock %}

{% block content %}
<div>
{{ user.name }}
    <h1>Repositories</h1>
    <form action="/refresh" method="POST">
        <input type="submit" name="refresh" value="Refresh"/>
        <input type="hidden" name="timezone" value="Europe/London"/>
    </form>
</div>

<div class="repository-list">

    <ul id="repositories">
        {% for repo in repositories %}
        <li>
            <span>{{ repo.getFullName() }}</span>
            <span>{{ repo.getDescription() }}</span>
            <span><input class="select_repo" id="{{ repo.getFullName() }}" type="checkbox"{% if repo.isActive() %} checked {% endif %}></span>
        </li>
        {% endfor %}
    </ul>

</div>
{% endblock %}


{% block bodyjs %}
<script type="text/javascript">

    // attach handler when clicking the select_repo checkboxes
    $(document).ready(function() {
        $(".select_repo").each(function(index){
            $(this).click(function() {

                // post to server here
                console.log("checkbox " + index + ' ' + this.checked);

                $.ajax({
                    url: "/repositories/" + this.id,
                    data: {
                        active : this.checked,
                        timezone: jstz.determine().name()
                    },
                    method: 'POST'
                }).done(function(data) {
                    console.log('Success ' + JSON.stringify(data));
                }).fail(function(data) {
                    console.log('Error ' + JSON.stringify(data));
                });
            });
        });

    });
</script>
{% endblock %}
